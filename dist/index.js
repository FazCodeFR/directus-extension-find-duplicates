import{useApi as e,useStores as l,defineModule as t}from"@directus/extensions-sdk";import{ref as n,watch as i,computed as a,resolveComponent as o,createBlock as r,openBlock as s,unref as d,withCtx as u,createElementVNode as c,createElementBlock as p,createCommentVNode as m,createVNode as v,toDisplayString as f,createTextVNode as g,Fragment as h,renderList as b}from"vue";import{useI18n as y}from"vue-i18n";const k={en:{title:"Find Duplicates",selectCollection:"Select a Collection",chooseCollection:"Choose a collection",selectField:"Select a Field",chooseField:"Choose a field",findDuplicates:"Find Duplicates",noDuplicates:"No duplicates found ðŸŽ‰",duplicatesFound:"Duplicates Found",openItem:"Open Item",duplicatesFor:"Duplicates for",value:"Value",times:"times",delete:"Delete",deleting:"Deleting...",confirmDelete:"Are you sure you want to delete this item?",deleteError:"Error deleting item. Please try again.",clickAgainToConfirm:"Click again to confirm deletion",deleteAllDuplicates:"Delete All Duplicates",deletingAll:"Deleting All...",confirmDeleteAll:"Are you sure you want to delete {count} duplicate items? This will keep only the first item in each duplicate group.",deleteAllError:"Error deleting some items. Please check the console for details."},fr:{title:"Rechercher les doublons",selectCollection:"SÃ©lectionner une collection",chooseCollection:"Choisir une collection",selectField:"SÃ©lectionner un champ",chooseField:"Choisir un champ",findDuplicates:"Rechercher les doublons",noDuplicates:"Aucun doublon trouvÃ© ðŸŽ‰",duplicatesFound:"Doublons trouvÃ©s",openItem:"Ouvrir l'Ã©lÃ©ment",duplicatesFor:"Doublons pour",value:"Valeur",times:"fois",delete:"Supprimer",deleting:"Suppression...",confirmDelete:"ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ©ment ?",deleteError:"Erreur lors de la suppression. Veuillez rÃ©essayer.",clickAgainToConfirm:"Cliquez Ã  nouveau pour confirmer la suppression",deleteAllDuplicates:"Supprimer tous les doublons",deletingAll:"Suppression en cours...",confirmDeleteAll:"ÃŠtes-vous sÃ»r de vouloir supprimer {count} Ã©lÃ©ments en double ? Cela ne gardera que le premier Ã©lÃ©ment de chaque groupe de doublons.",deleteAllError:"Erreur lors de la suppression de certains Ã©lÃ©ments. Veuillez vÃ©rifier la console pour plus de dÃ©tails."},tr:{title:"Yinelenenleri Bul",selectCollection:"Bir koleksiyon seÃ§in",chooseCollection:"Bir koleksiyon seÃ§in",selectField:"Bir alan seÃ§in",chooseField:"Bir alan seÃ§in",findDuplicates:"Yinelenenleri Bul",noDuplicates:"HiÃ§ yineleyen deÄŸer yok ðŸŽ‰",duplicatesFound:"Yinelenen deÄŸerler bulundu",openItem:"KaydÄ± AÃ§",duplicatesFor:"Yinelenenler iÃ§in",value:"DeÄŸer",times:"tekrar",delete:"Sil",deleting:"Siliniyor...",confirmDelete:"Bu Ã¶ÄŸeyi silmek istediÄŸinizden emin misiniz?",deleteError:"Ã–ÄŸe silinirken hata oluÅŸtu. LÃ¼tfen tekrar deneyin.",clickAgainToConfirm:"Silmeyi onaylamak iÃ§in tekrar tÄ±klayÄ±n",deleteAllDuplicates:"TÃ¼m Yinelenenleri Sil",deletingAll:"TÃ¼mÃ¼ Siliniyor...",confirmDeleteAll:"{count} yinelenen Ã¶ÄŸeyi silmek istediÄŸinizden emin misiniz? Bu, her yinelenen grubundaki yalnÄ±zca ilk Ã¶ÄŸeyi tutacaktÄ±r.",deleteAllError:"BazÄ± Ã¶ÄŸeler silinirken hata oluÅŸtu. LÃ¼tfen detaylar iÃ§in konsolu kontrol edin."}};var C=[],x=[];!function(e,l){if(e&&"undefined"!=typeof document){var t,n=!0===l.prepend?"prepend":"append",i=!0===l.singleTag,a="string"==typeof l.container?document.querySelector(l.container):document.getElementsByTagName("head")[0];if(i){var o=C.indexOf(a);-1===o&&(o=C.push(a)-1,x[o]={}),t=x[o]&&x[o][n]?x[o][n]:x[o][n]=r()}else t=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),l.attributes)for(var t=Object.keys(l.attributes),i=0;i<t.length;i++)e.setAttribute(t[i],l.attributes[t[i]]);var o="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(o,e),e}}("\n.step[data-v-4e99f9da] {\n  margin-bottom: 30px;\n  padding: 0 46px;\n}\n.step > h2[data-v-4e99f9da] {\n  margin-bottom: 16px;\n}\n.button-group[data-v-4e99f9da] {\n  display: flex;\n  gap: 12px;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.button-group .v-button[data-v-4e99f9da] {\n  flex-shrink: 0;\n}\n.duplicates-list[data-v-4e99f9da] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.duplicate-group[data-v-4e99f9da] {\n  margin-bottom: 0;\n}\n.text-primary[data-v-4e99f9da] {\n  color: var(--primary);\n}\n.alert[data-v-4e99f9da] {\n  padding: 12px 46px;\n  border-radius: 6px;\n  margin-top: 16px;\n  max-width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.alert.success[data-v-4e99f9da] {\n  background: var(--theme--success-background, #e0ffe0);\n  color: var(--theme--success-foreground, #067d06);\n  border: 1px solid var(--theme--success-border, #9de89d);\n}\n.duplicate-item[data-v-4e99f9da] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 8px;\n  list-style: none;\n}\n.delete-button[data-v-4e99f9da] {\n  margin-left: auto;\n  flex-shrink: 0;\n}\n.delete-button[data-v-4e99f9da] .v-icon,\n.delete-button[data-v-4e99f9da] svg,\n.delete-button[data-v-4e99f9da] i {\n  color: var(--primary) !important;\n}\n.delete-button[data-v-4e99f9da]:hover .v-icon,\n.delete-button[data-v-4e99f9da]:hover svg,\n.delete-button[data-v-4e99f9da]:hover i {\n  color: var(--primary-125) !important;\n}\n.delete-button[data-v-4e99f9da]:disabled .v-icon,\n.delete-button[data-v-4e99f9da]:disabled svg,\n.delete-button[data-v-4e99f9da]:disabled i {\n  color: var(--foreground-subdued) !important;\n  opacity: 0.5;\n}\n.delete-all-button[data-v-4e99f9da] {\n  flex-shrink: 0;\n  white-space: nowrap;\n}\n",{});var D=(e,l)=>{const t=e.__vccOpts||e;for(const[e,n]of l)t[e]=n;return t};const A={class:"step"},F={class:"step"},S={class:"step button-group"},E={key:0,class:"alert success"},w={key:1,class:"step"},_={class:"duplicates-list"},B={class:"font-bold mb-2"},T={class:"ml-2"},V=["href"],z={__name:"module",setup(t){const C=e(),{useCollectionsStore:x,useFieldsStore:D}=l(),z=x(),$=D(),I=n(null),O=n([]),j=n([]),L=n(!1),Y=n(new Set),q=n(!1),{useSettingsStore:U}=l(),{settings:N}=U(),P=N?.default_language,{t:R}=y({locale:(H=P,H?H.includes("-")?H.split("-")[0].toLowerCase():H.toLowerCase():"en"),messages:k});var H;i(O,()=>{j.value=[],L.value=!1});const K=a(()=>Object.values(z.collections).filter(e=>!e.system).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.collection})).sort((e,l)=>e.label.localeCompare(l.label))),G=a(()=>{if(!I.value)return[];return $.getFieldsForCollection(I.value).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.field})).sort((e,l)=>e.label.localeCompare(l.label))});async function J(){O.value=[],j.value=[],L.value=!1}async function M(){j.value=[],L.value=!1;const e=O.value,l=I.value;if(!e.length)return;const{data:t}=await C.get(`/items/${l}`,{params:{limit:-1,fields:["id",...e]}}),n={};for(const l of t.data){const t=e.map(e=>(l[e]??"").toString().trim().toLowerCase()).join("||");t&&(n[t]||(n[t]=[]),n[t].push(l))}j.value=Object.entries(n).filter(([,e])=>e.length>1).map(([e,l])=>({value:e,items:l})),L.value=!0}async function Q(){const e=j.value.reduce((e,l)=>e+(l.items.length-1),0),l=R("confirmDeleteAll").replace("{count}",e);if(confirm(l)){q.value=!0;try{for(let e=j.value.length-1;e>=0;e--){const l=j.value[e];for(let e=l.items.length-1;e>0;e--){const t=l.items[e];Y.value.add(t.id);try{await C.delete(`/items/${I.value}/${t.id}`),l.items.splice(e,1)}catch(e){console.error(`Error deleting item ${t.id}:`,e)}finally{Y.value.delete(t.id)}}l.items.length<=1&&j.value.splice(e,1)}}catch(e){console.error("Error deleting all duplicates:",e),alert(R("deleteAllError"))}finally{q.value=!1}}}return(e,l)=>{const t=o("v-select"),n=o("v-button"),i=o("v-icon"),a=o("v-card"),y=o("private-view");return s(),r(y,{title:d(R)("title"),class:"find-duplicates-ui"},{default:u(()=>[c("div",A,[c("h2",null,f(d(R)("selectCollection")),1),v(t,{modelValue:I.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>I.value=e),J],items:K.value,"item-text":"label","item-value":"value",label:d(R)("chooseCollection")},null,8,["modelValue","items","label"])]),c("div",F,[c("h2",null,f(d(R)("selectField")),1),v(t,{modelValue:O.value,"onUpdate:modelValue":l[1]||(l[1]=e=>O.value=e),items:G.value,"item-text":"label","item-value":"value",label:d(R)("chooseField"),multiple:"",disabled:!I.value},null,8,["modelValue","items","label","disabled"])]),c("div",S,[v(n,{onClick:M,disabled:0===O.value.length},{default:u(()=>[g(f(d(R)("findDuplicates")),1)]),_:1},8,["disabled"]),j.value.length>0?(s(),r(n,{key:0,onClick:Q,disabled:q.value},{default:u(()=>[g(f(q.value?d(R)("deletingAll"):d(R)("deleteAllDuplicates")),1)]),_:1},8,["disabled"])):m("v-if",!0)]),0===j.value.length&&L.value?(s(),p("div",E,f(d(R)("noDuplicates")),1)):m("v-if",!0),j.value.length>0?(s(),p("div",w,[c("h2",null,f(d(R)("duplicatesFound"))+" ("+f(j.value.length)+")",1),c("div",_,[(s(!0),p(h,null,b(j.value,(e,l)=>(s(),r(a,{key:l,class:"p-4 duplicate-group"},{default:u(()=>[c("div",B,[g(f(d(R)("duplicatesFor"))+": ",1),c("span",T,f(O.value.map(l=>e.items[0][l]).join(" | ")),1),g(" ("+f(e.items.length)+" "+f(d(R)("times"))+") ",1)]),c("ul",null,[(s(!0),p(h,null,b(e.items,(e,t)=>(s(),p("li",{key:e.id,class:"duplicate-item"},[c("a",{href:`/admin/content/${I.value}/${e.id}`,class:"text-primary underline",target:"_blank"},f(d(R)("openItem"))+" #"+f(e.id),9,V),t>0?(s(),r(n,{key:0,disabled:Y.value.has(e.id),onClick:t=>async function(e,l){if(confirm(R("confirmDelete"))){Y.value.add(e);try{await C.delete(`/items/${I.value}/${e}`);const t=j.value[l].items.findIndex(l=>l.id===e);-1!==t&&(j.value[l].items.splice(t,1),j.value[l].items.length<=1&&j.value.splice(l,1))}catch(e){console.error("Error deleting item:",e),alert(R("deleteError"))}finally{Y.value.delete(e)}}}(e.id,l),icon:"",small:"",rounded:"",secondary:"",class:"delete-button",title:Y.value.has(e.id)?d(R)("deleting"):d(R)("delete")},{default:u(()=>[v(i,{name:"delete"})]),_:2},1032,["disabled","onClick","title"])):m("v-if",!0)]))),128))])]),_:2},1024))),128))])])):m("v-if",!0)]),_:1},8,["title"])}}};var $=t({id:"find-duplicates",name:"Find Duplicates",icon:"search",routes:[{path:"",component:D(z,[["__scopeId","data-v-4e99f9da"]])}]});export{$ as default};
