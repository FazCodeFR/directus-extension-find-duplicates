import{useApi as e,useStores as t,defineModule as l}from"@directus/extensions-sdk";import{ref as a,computed as n,resolveComponent as s,createBlock as o,openBlock as i,unref as u,withCtx as c,createElementVNode as r,createElementBlock as d,createCommentVNode as p,createVNode as m,toDisplayString as v,createTextVNode as f,Fragment as h,renderList as b}from"vue";import{useI18n as g}from"vue-i18n";const C={en:{title:"Find Duplicates",selectCollection:"Select a Collection",chooseCollection:"Choose a collection",selectField:"Select a Field",chooseField:"Choose a field",findDuplicates:"Find Duplicates",noDuplicates:"No duplicates found ðŸŽ‰",duplicatesFound:"Duplicates Found",openItem:"Open Item",duplicatesFor:"Duplicates for",value:"Value",times:"times"},fr:{title:"Rechercher les doublons",selectCollection:"SÃ©lectionner une collection",chooseCollection:"Choisir une collection",selectField:"SÃ©lectionner un champ",chooseField:"Choisir un champ",findDuplicates:"Rechercher les doublons",noDuplicates:"Aucun doublon trouvÃ© ðŸŽ‰",duplicatesFound:"Doublons trouvÃ©s",openItem:"Ouvrir l'Ã©lÃ©ment",duplicatesFor:"Doublons pour",value:"Valeur",times:"fois"}};var x=[],F=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,a=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,s="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var o=x.indexOf(s);-1===o&&(o=x.push(s)-1,F[o]={}),l=F[o]&&F[o][a]?F[o][a]:F[o][a]=i()}else l=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),n=0;n<l.length;n++)e.setAttribute(l[n],t.attributes[l[n]]);var o="prepend"===a?"afterbegin":"beforeend";return s.insertAdjacentElement(o,e),e}}("\n.step[data-v-300de3e8] {\n  margin-bottom: 30px;\n  padding: 0 46px;\n}\n.text-primary[data-v-300de3e8] {\n  color: var(--primary);\n}\n.alert[data-v-300de3e8] {\n  padding: 12px 46px;\n  border-radius: 6px;\n  margin-top: 16px;\n  max-width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.alert.success[data-v-300de3e8] {\n  background: var(--theme--success-background, #e0ffe0);\n  color: var(--theme--success-foreground, #067d06);\n  border: 1px solid var(--theme--success-border, #9de89d);\n}\n",{});var y=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l};const D={class:"step"},S={class:"step"},_={class:"step"},k={key:0,class:"alert success"},V={key:1,class:"step"},A={class:"font-bold mb-2"},O={class:"ml-2"},j=["href"],w={__name:"module",setup(l){const x=e(),{useCollectionsStore:F,useFieldsStore:y}=t(),w=F(),I=y(),T=a(null),U=a([]),E=a([]),L=a(!1),{useSettingsStore:N}=t(),{settings:$}=N(),R=$?.default_language,{t:q}=g({locale:(B=R,B?B.includes("-")?B.split("-")[0].toLowerCase():B.toLowerCase():"en"),messages:C});var B;const z=n(()=>Object.values(w.collections).filter(e=>!e.system).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.collection})).sort((e,t)=>e.label.localeCompare(t.label))),G=n(()=>{if(!T.value)return[];return I.getFieldsForCollection(T.value).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.field})).sort((e,t)=>e.label.localeCompare(t.label))});async function H(){U.value=[],E.value=[],L.value=!1}async function J(){E.value=[],L.value=!1;const e=U.value,t=T.value;if(!e.length)return;const{data:l}=await x.get(`/items/${t}`,{params:{limit:-1,fields:["id",...e]}}),a={};for(const t of l.data){const l=e.map(e=>(t[e]??"").toString().trim().toLowerCase()).join("||");l&&(a[l]||(a[l]=[]),a[l].push(t))}E.value=Object.entries(a).filter(([,e])=>e.length>1).map(([e,t])=>({value:e,items:t})),L.value=!0}return(e,t)=>{const l=s("v-select"),a=s("v-button"),n=s("v-card"),g=s("private-view");return i(),o(g,{title:u(q)("title"),class:"find-duplicates-ui"},{default:c(()=>[r("div",D,[r("h2",null,v(u(q)("selectCollection")),1),m(l,{modelValue:T.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>T.value=e),H],items:z.value,"item-text":"label","item-value":"value",label:u(q)("chooseCollection")},null,8,["modelValue","items","label"])]),r("div",S,[r("h2",null,v(u(q)("selectField")),1),m(l,{modelValue:U.value,"onUpdate:modelValue":t[1]||(t[1]=e=>U.value=e),items:G.value,"item-text":"label","item-value":"value",label:u(q)("chooseField"),multiple:"",disabled:!T.value},null,8,["modelValue","items","label","disabled"])]),r("div",_,[m(a,{onClick:J,disabled:0===U.value.length},{default:c(()=>[f(v(u(q)("findDuplicates")),1)]),_:1},8,["disabled"])]),0===E.value.length&&L.value?(i(),d("div",k,v(u(q)("noDuplicates")),1)):p("v-if",!0),E.value.length>0?(i(),d("div",V,[r("h2",null,v(u(q)("duplicatesFound"))+" ("+v(E.value.length)+")",1),(i(!0),d(h,null,b(E.value,(e,t)=>(i(),o(n,{key:t,class:"p-4"},{default:c(()=>[r("div",A,[f(v(u(q)("duplicatesFor"))+": ",1),r("span",O,v(U.value.map(t=>e.items[0][t]).join(" | ")),1),f(" ("+v(e.items.length)+" "+v(u(q)("times"))+") ",1)]),r("ul",null,[(i(!0),d(h,null,b(e.items,e=>(i(),d("li",{key:e.id},[r("a",{href:`/admin/content/${T.value}/${e.id}`,class:"text-primary underline",target:"_blank"},v(u(q)("openItem"))+" #"+v(e.id),9,j)]))),128))])]),_:2},1024))),128))])):p("v-if",!0)]),_:1},8,["title"])}}};var I=l({id:"directus-extension-find-duplicates",name:"Find Duplicates",icon:"search",routes:[{path:"",component:y(w,[["__scopeId","data-v-300de3e8"]])}]});export{I as default};
