import{useApi as e,useStores as t,defineModule as l}from"@directus/extensions-sdk";import{ref as a,computed as n,resolveComponent as s,createBlock as o,openBlock as i,unref as u,withCtx as c,createElementVNode as r,createElementBlock as d,createCommentVNode as p,createVNode as m,toDisplayString as v,createTextVNode as f,Fragment as b,renderList as h}from"vue";import{useI18n as g}from"vue-i18n";const C={en:{title:"Find Duplicates",selectCollection:"Select a Collection",chooseCollection:"Choose a collection",selectField:"Select a Field",chooseField:"Choose a field",findDuplicates:"Find Duplicates",noDuplicates:"No duplicates found ðŸŽ‰",duplicatesFound:"Duplicates Found",openItem:"Open Item",duplicatesFor:"Duplicates for",value:"Value",times:"times"},fr:{title:"Rechercher les doublons",selectCollection:"SÃ©lectionner une collection",chooseCollection:"Choisir une collection",selectField:"SÃ©lectionner un champ",chooseField:"Choisir un champ",findDuplicates:"Rechercher les doublons",noDuplicates:"Aucun doublon trouvÃ© ðŸŽ‰",duplicatesFound:"Doublons trouvÃ©s",openItem:"Ouvrir l'Ã©lÃ©ment",duplicatesFor:"Doublons pour",value:"Valeur",times:"fois"}};var y=[],F=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,a=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,s="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var o=y.indexOf(s);-1===o&&(o=y.push(s)-1,F[o]={}),l=F[o]&&F[o][a]?F[o][a]:F[o][a]=i()}else l=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),n=0;n<l.length;n++)e.setAttribute(l[n],t.attributes[l[n]]);var o="prepend"===a?"afterbegin":"beforeend";return s.insertAdjacentElement(o,e),e}}("\n.step[data-v-2b7d3c2f] {\n  margin-bottom: 30px;\n  padding: 0 46px;\n}\n.text-primary[data-v-2b7d3c2f] {\n  color: var(--primary);\n}\n.alert[data-v-2b7d3c2f] {\n  padding: 12px 46px;\n  border-radius: 6px;\n  margin-top: 16px;\n  max-width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.alert.success[data-v-2b7d3c2f] {\n  background: var(--theme--success-background, #e0ffe0);\n  color: var(--theme--success-foreground, #067d06);\n  border: 1px solid var(--theme--success-border, #9de89d);\n}\n",{});var x=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l};const D={class:"step"},S={class:"step"},_={class:"step"},k={key:0,class:"alert success"},V={key:1,class:"step"},w={class:"font-bold mb-2"},A={class:"ml-2"},O=["href"],j={__name:"module",setup(l){const y=e(),{useCollectionsStore:F,useFieldsStore:x}=t(),j=F(),I=x(),U=a(null),$=a([]),E=a([]),T=a(!1),{useSettingsStore:L}=t(),{settings:N}=L(),R=N?.default_language,{t:q}=g({locale:(B=R,B?B.includes("-")?B.split("-")[0].toLowerCase():B.toLowerCase():"en"),messages:C});var B;const P=n(()=>Object.values(j.collections).filter(e=>!e.system).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.collection})).sort((e,t)=>e.label.localeCompare(t.label))),z=n(()=>{if(!U.value)return[];return I.getFieldsForCollection(U.value).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.field})).sort((e,t)=>e.label.localeCompare(t.label))});async function G(){$.value=[],E.value=[],T.value=!1}async function H(){E.value=[],T.value=!1;const e=$.value,t=U.value;if(!e.length)return;const l=new URLSearchParams;e.forEach(e=>l.append("groupBy[]",e)),l.append("aggregate[count]","*"),l.append("limit","-1");const{data:a}=await y.get(`/items/${t}?${l.toString()}`),n=a.data.filter(e=>e.count>1),s=[];for(const l of n){const a={_and:e.map(e=>({[e]:{_eq:l[e]}}))},{data:n}=await y.get(`/items/${t}`,{params:{limit:-1,filter:a,fields:["id",...e]}});s.push({value:e.map(e=>l[e]).join(" | "),items:n.data})}E.value=s,T.value=!0}return(e,t)=>{const l=s("v-select"),a=s("v-button"),n=s("v-card"),g=s("private-view");return i(),o(g,{title:u(q)("title"),class:"find-duplicates-ui"},{default:c(()=>[r("div",D,[r("h2",null,v(u(q)("selectCollection")),1),m(l,{modelValue:U.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>U.value=e),G],items:P.value,"item-text":"label","item-value":"value",label:u(q)("chooseCollection")},null,8,["modelValue","items","label"])]),r("div",S,[r("h2",null,v(u(q)("selectField")),1),m(l,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=e=>$.value=e),items:z.value,"item-text":"label","item-value":"value",label:u(q)("chooseField"),multiple:"",disabled:!U.value},null,8,["modelValue","items","label","disabled"])]),r("div",_,[m(a,{onClick:H,disabled:0===$.value.length},{default:c(()=>[f(v(u(q)("findDuplicates")),1)]),_:1},8,["disabled"])]),0===E.value.length&&T.value?(i(),d("div",k,v(u(q)("noDuplicates")),1)):p("v-if",!0),E.value.length>0?(i(),d("div",V,[r("h2",null,v(u(q)("duplicatesFound"))+" ("+v(E.value.length)+")",1),(i(!0),d(b,null,h(E.value,(e,t)=>(i(),o(n,{key:t,class:"p-4"},{default:c(()=>[r("div",w,[f(v(u(q)("duplicatesFor"))+": ",1),r("span",A,v($.value.map(t=>e.items[0][t]).join(" | ")),1),f(" ("+v(e.items.length)+" "+v(u(q)("times"))+") ",1)]),r("ul",null,[(i(!0),d(b,null,h(e.items,e=>(i(),d("li",{key:e.id},[r("a",{href:`/admin/content/${U.value}/${e.id}`,class:"text-primary underline",target:"_blank"},v(u(q)("openItem"))+" #"+v(e.id),9,O)]))),128))])]),_:2},1024))),128))])):p("v-if",!0)]),_:1},8,["title"])}}};var I=l({id:"find-duplicates",name:"Find Duplicates",icon:"search",routes:[{path:"",component:x(j,[["__scopeId","data-v-2b7d3c2f"]])}]});export{I as default};
