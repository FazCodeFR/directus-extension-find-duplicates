import{useApi as e,useStores as t,defineModule as l}from"@directus/extensions-sdk";import{ref as a,watch as n,computed as s,resolveComponent as o,createBlock as i,openBlock as u,unref as c,withCtx as r,createElementVNode as d,createElementBlock as p,createCommentVNode as m,createVNode as v,toDisplayString as f,createTextVNode as h,Fragment as b,renderList as g}from"vue";import{useI18n as C}from"vue-i18n";const y={en:{title:"Find Duplicates",selectCollection:"Select a Collection",chooseCollection:"Choose a collection",selectField:"Select a Field",chooseField:"Choose a field",findDuplicates:"Find Duplicates",noDuplicates:"No duplicates found ðŸŽ‰",duplicatesFound:"Duplicates Found",openItem:"Open Item",duplicatesFor:"Duplicates for",value:"Value",times:"times"},fr:{title:"Rechercher les doublons",selectCollection:"SÃ©lectionner une collection",chooseCollection:"Choisir une collection",selectField:"SÃ©lectionner un champ",chooseField:"Choisir un champ",findDuplicates:"Rechercher les doublons",noDuplicates:"Aucun doublon trouvÃ© ðŸŽ‰",duplicatesFound:"Doublons trouvÃ©s",openItem:"Ouvrir l'Ã©lÃ©ment",duplicatesFor:"Doublons pour",value:"Valeur",times:"fois"}};var F=[],x=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,a=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,s="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var o=F.indexOf(s);-1===o&&(o=F.push(s)-1,x[o]={}),l=x[o]&&x[o][a]?x[o][a]:x[o][a]=i()}else l=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),n=0;n<l.length;n++)e.setAttribute(l[n],t.attributes[l[n]]);var o="prepend"===a?"afterbegin":"beforeend";return s.insertAdjacentElement(o,e),e}}("\n.step[data-v-0fc80890] {\n  margin-bottom: 30px;\n  padding: 0 46px;\n}\n.text-primary[data-v-0fc80890] {\n  color: var(--primary);\n}\n.alert[data-v-0fc80890] {\n  padding: 12px 46px;\n  border-radius: 6px;\n  margin-top: 16px;\n  max-width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.alert.success[data-v-0fc80890] {\n  background: var(--theme--success-background, #e0ffe0);\n  color: var(--theme--success-foreground, #067d06);\n  border: 1px solid var(--theme--success-border, #9de89d);\n}\n",{});var D=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l};const S={class:"step"},_={class:"step"},k={class:"step"},V={key:0,class:"alert success"},w={key:1,class:"step"},A={class:"font-bold mb-2"},O={class:"ml-2"},j=["href"],I={__name:"module",setup(l){const F=e(),{useCollectionsStore:x,useFieldsStore:D}=t(),I=x(),U=D(),$=a(null),E=a([]),T=a([]),L=a(!1),{useSettingsStore:N}=t(),{settings:R}=N(),q=R?.default_language,{t:B}=C({locale:(P=q,P?P.includes("-")?P.split("-")[0].toLowerCase():P.toLowerCase():"en"),messages:y});var P;n(E,()=>{T.value=[],L.value=!1});const z=s(()=>Object.values(I.collections).filter(e=>!e.system).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.collection})).sort((e,t)=>e.label.localeCompare(t.label))),G=s(()=>{if(!$.value)return[];return U.getFieldsForCollection($.value).map(e=>({label:e.name.charAt(0).toUpperCase()+e.name.slice(1),value:e.field})).sort((e,t)=>e.label.localeCompare(t.label))});async function H(){E.value=[],T.value=[],L.value=!1}async function J(){T.value=[],L.value=!1;const e=E.value,t=$.value;if(!e.length)return;const l=new URLSearchParams;e.forEach(e=>l.append("groupBy[]",e)),l.append("aggregate[count]","*"),l.append("limit","-1");const{data:a}=await F.get(`/items/${t}?${l.toString()}`),n=a.data.filter(e=>e.count>1),s=[];for(const l of n){const a={_and:e.map(e=>({[e]:{_eq:l[e]}}))},{data:n}=await F.get(`/items/${t}`,{params:{limit:-1,filter:a,fields:["id",...e]}});s.push({value:e.map(e=>l[e]).join(" | "),items:n.data})}T.value=s,L.value=!0}return(e,t)=>{const l=o("v-select"),a=o("v-button"),n=o("v-card"),s=o("private-view");return u(),i(s,{title:c(B)("title"),class:"find-duplicates-ui"},{default:r(()=>[d("div",S,[d("h2",null,f(c(B)("selectCollection")),1),v(l,{modelValue:$.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>$.value=e),H],items:z.value,"item-text":"label","item-value":"value",label:c(B)("chooseCollection")},null,8,["modelValue","items","label"])]),d("div",_,[d("h2",null,f(c(B)("selectField")),1),v(l,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=e=>E.value=e),items:G.value,"item-text":"label","item-value":"value",label:c(B)("chooseField"),multiple:"",disabled:!$.value},null,8,["modelValue","items","label","disabled"])]),d("div",k,[v(a,{onClick:J,disabled:0===E.value.length},{default:r(()=>[h(f(c(B)("findDuplicates")),1)]),_:1},8,["disabled"])]),0===T.value.length&&L.value?(u(),p("div",V,f(c(B)("noDuplicates")),1)):m("v-if",!0),T.value.length>0?(u(),p("div",w,[d("h2",null,f(c(B)("duplicatesFound"))+" ("+f(T.value.length)+")",1),(u(!0),p(b,null,g(T.value,(e,t)=>(u(),i(n,{key:t,class:"p-4"},{default:r(()=>[d("div",A,[h(f(c(B)("duplicatesFor"))+": ",1),d("span",O,f(E.value.map(t=>e.items[0][t]).join(" | ")),1),h(" ("+f(e.items.length)+" "+f(c(B)("times"))+") ",1)]),d("ul",null,[(u(!0),p(b,null,g(e.items,e=>(u(),p("li",{key:e.id},[d("a",{href:`/admin/content/${$.value}/${e.id}`,class:"text-primary underline",target:"_blank"},f(c(B)("openItem"))+" #"+f(e.id),9,j)]))),128))])]),_:2},1024))),128))])):m("v-if",!0)]),_:1},8,["title"])}}};var U=l({id:"find-duplicates",name:"Find Duplicates",icon:"search",routes:[{path:"",component:D(I,[["__scopeId","data-v-0fc80890"]])}]});export{U as default};
